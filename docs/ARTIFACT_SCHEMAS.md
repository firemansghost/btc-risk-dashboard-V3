# Data Artifact Schemas

Authoritative data contracts for all system artifacts.

## latest.json

Main dashboard data artifact generated by ETL pipeline.

```json
{
  "version": "v3.1.0",
  "updated_at": "2025-09-17T12:00:00.000Z",
  "price_usd": 67500.00,
  "composite_raw": 50,
  "composite_score": 50,
  "band": {
    "name": "Hold/Neutral",
    "lo": 35,
    "hi": 55,
    "color": "#f59e0b",
    "recommendation": "Wait and watch market conditions"
  },
  "pillars": [
    {
      "key": "liquidity",
      "weight": 40,
      "score": 45,
      "status": "fresh"
    }
  ],
  "factors": [
    {
      "key": "etf_flows",
      "label": "ETF Flows",
      "pillar": "liquidity",
      "weight": 10,
      "score": 93,
      "status": "fresh",
      "reason": "success",
      "details": [
        {
          "label": "Latest Daily Flow",
          "value": "$292K",
          "tooltip": "Exact: $292.3K (2025-09-16)"
        }
      ],
      "individualEtfFlows": {
        "ibit": 209.2,
        "fbtc": 45.8,
        "bitb": -10.8
      }
    }
  ],
  "adjustments": {
    "cycle": { "adj_pts": 0, "reason": "disabled" },
    "spike": { "adj_pts": 0, "reason": "disabled" }
  },
  "cross": {
    "btc_per_oz": 31.41975750291805,
    "oz_per_btc": 0.03182710751052509
  },
  "config_digest": "etl_v3.1.0"
}
```

## status.json

System health and data source status.

```json
{
  "updated_at": "2025-09-17T12:00:00.000Z",
  "sources": [
    {
      "name": "FRED API",
      "ok": true,
      "ms": 245,
      "url": "https://api.stlouisfed.org/fred/",
      "schema_hash": "abc123",
      "z_tripwire": false,
      "cache_used": false
    },
    {
      "name": "Farside Investors",
      "ok": true,
      "ms": 1200,
      "url": "https://farside.co.uk/bitcoin-etf-flow/",
      "schema_hash": "def456",
      "z_tripwire": false,
      "cache_used": true
    }
  ]
}
```

## history.csv

Historical risk scores and metadata.

```csv
date,score,band,price_usd,version
2025-09-17,50,Hold/Neutral,67500.00,v3.1.0
2025-09-16,48,Regular DCA Buying,67200.00,v3.1.0
2025-09-15,52,Hold/Neutral,66800.00,v3.1.0
```

## signals/etf_flows_21d.csv

ETF flows signal data with statistical analysis.

```csv
date,day_flow_usd,sum21_usd,z,pct,score
2025-09-17,292300,2388700,-1.34,0.07,93
2025-09-16,185600,2156400,-1.45,0.05,95
2025-09-15,320100,1970800,-1.28,0.08,92
```

## signals/etf_by_fund.csv

Per-ETF breakdown with individual fund flows, 21-day rolling sums, and cumulative totals.

```csv
date,symbol,day_flow_usd,sum21_usd,cumulative_usd
2025-09-17,IBIT,125000,1850000,12500000
2025-09-17,FBTC,85000,1200000,8500000
2025-09-17,BITB,45000,650000,4500000
2025-09-16,IBIT,110000,1725000,12375000
2025-09-16,FBTC,75000,1115000,8415000
```

**Columns:**
- `date`: UTC date (YYYY-MM-DD)
- `symbol`: ETF ticker symbol (e.g., IBIT, FBTC, BITB)
- `day_flow_usd`: Daily flow in USD (positive = inflow, negative = outflow)
- `sum21_usd`: 21-day rolling sum in USD (business days only)
- `cumulative_usd`: Cumulative total from fund inception in USD

## signals/btc_xau.csv

BTC⇄Gold historical cross-rates data.

```csv
date,btc_close_usd,xau_close_usd,btc_per_oz,oz_per_btc
2025-09-17,115817.47,3686.135,31.41975750291805,0.03182710751052509
2025-09-16,114200.00,3680.50,31.025,0.0322
2025-09-15,113500.00,3675.25,30.875,0.0324
```

## signals/sats_per_usd.csv

Satoshis per Dollar historical data (display-only, derived from BTC daily close).

```csv
date,sats_per_usd,usd_per_sat,btc_close_usd
2025-09-17,864.4404386274518,0.0011568177000000001,115681.77
2025-09-16,875.1234567890123,0.0011428571428571429,114200.00
2025-09-15,881.0572687224669,0.0011350000000000001,113500.00
```

## Factor History CSVs

Per-factor historical data for transparency and analysis (CSV-first approach).

### signals/stablecoins_30d.csv
```csv
date,pct_change_30d,z,score
2025-09-17,8.3,0,23
2025-09-16,7.8,-0.2,25
2025-09-15,8.1,0.1,22
```

### signals/etf_flows_21d.csv
```csv
date,day_flow_usd,sum21_usd,z,pct,score
2025-09-17,292300,2388700,-1.34,0.07,93
2025-09-16,185600,2156400,-1.45,0.05,95
2025-09-15,320100,1970800,-1.28,0.08,92
```

### signals/net_liquidity_20d.csv
```csv
date,delta20d_usd,z,score
2025-09-17,2.1,1.8,93
2025-09-16,2.0,1.7,91
2025-09-15,1.9,1.6,89
```

### signals/mayer_multiple.csv
```csv
date,mayer,stretch,z,score
2025-09-17,1.2,0.8,-0.5,48
2025-09-16,1.3,0.9,-0.3,45
2025-09-15,1.1,0.7,-0.7,52
```

### signals/funding_7d.csv
```csv
date,funding_7d_avg,z,score
2025-09-17,0.02,0.1,40
2025-09-16,0.01,0.0,42
2025-09-15,0.03,0.2,38
```

### signals/dxy_20d.csv
```csv
date,dxy_delta20d,z,score
2025-09-17,1.2,0.5,34
2025-09-16,1.0,0.3,36
2025-09-15,1.4,0.7,32
```

### signals/fear_greed.csv
```csv
date,fng_value,z,score
2025-09-17,21,-1.2,21
2025-09-16,23,-1.0,25
2025-09-15,19,-1.4,18
```

## Alert System Artifacts

Alert detection and logging for significant market events.

### alerts/latest.json

Current day's alerts (overwritten each ETL run).

```json
{
  "occurred_at": "2025-09-17T17:04:58.124Z",
  "alerts": [
    {
      "type": "etf_zero_cross",
      "direction": "up",
      "from": -1500000,
      "to": 2000000,
      "deadband": 50000
    },
    {
      "type": "band_change",
      "from": "Hold/Neutral",
      "to": "Buy",
      "composite_from": 45,
      "composite_to": 52
    }
  ]
}
```

### alerts/log.csv

Historical alert log (append-only, idempotent by date + type).

```csv
occurred_at,type,details
2025-09-17,etf_zero_cross,"{""type"":""etf_zero_cross"",""direction"":""up"",""from"":-1500000,""to"":2000000,""deadband"":50000}"
2025-09-17,band_change,"{""type"":""band_change"",""from"":""Hold/Neutral"",""to"":""Buy"",""composite_from"":45,""composite_to"":52}"
2025-09-16,etf_zero_cross,"{""type"":""etf_zero_cross"",""direction"":""down"",""from"":800000,""to"":-200000,""deadband"":45000}"
```

## extras/gold_cross.json

BTC⇄Gold cross-rates with provenance tracking.

```json
{
  "updated_at": "2025-09-17T15:41:15.323Z",
  "date": "2025-09-17",
  "btc_close_usd": 115817.47,
  "xau_close_usd": 3686.135,
  "btc_per_oz": 31.41975750291805,
  "oz_per_btc": 0.03182710751052509,
  "provenance": [
    {
      "name": "Stooq",
      "ok": true,
      "url": "https://stooq.com/",
      "ms": 1044,
      "fallback": true
    }
  ]
}
```

## extras/sats.json

Satoshis per Dollar cross-rates (display-only, derived from BTC daily close).

```json
{
  "updated_at": "2025-09-17T16:28:59.409Z",
  "date": "2025-09-17",
  "btc_close_usd": 115681.77,
  "sats_per_usd": 864.4404386274518,
  "usd_per_sat": 0.0011568177000000001,
  "provenance": [
    {
      "name": "BTC daily close (Coinbase)",
      "ok": true,
      "url": "https://api.exchange.coinbase.com/products/BTC-USD/candles?granularity=86400",
      "ms": null
    }
  ]
}
```

## API Response Schemas

### GET /api/data/latest

```json
{
  "ok": true,
  "as_of_utc": "2025-09-17T12:00:00.000Z",
  "composite_score": 50,
  "composite_raw": 50,
  "band": {
    "key": "hold_neutral",
    "label": "Hold/Neutral",
    "range": [35, 55],
    "color": "#f59e0b",
    "recommendation": "Wait and watch market conditions"
  },
  "health": "green",
  "factors": [...],
  "btc": {
    "spot_usd": 67500.00,
    "as_of_utc": "2025-09-17T12:00:00.000Z",
    "source": "ETL pipeline"
  },
  "provenance": [...],
  "model_version": "v3.1.0",
  "config_digest": "etl_v3.1.0",
  "transform": {}
}
```

### POST /api/refresh

Same schema as GET /api/data/latest, but with fresh real-time computation.

## Versioning

- **Semantic Versioning**: Major.Minor.Patch (e.g., v3.1.0)
- **Contract Changes**: Any schema change requires version bump
- **Backward Compatibility**: Maintained for at least 2 major versions
- **Migration Notes**: Documented in CHANGELOG.md for breaking changes

## Validation Rules

- **Required Fields**: All top-level fields must be present
- **Type Validation**: Strict type checking for all numeric and string fields
- **Range Validation**: Scores must be 0-100, dates must be valid ISO strings
- **Consistency Checks**: Factor weights must sum to 100%, band ranges must be valid
- **Staleness Rules**: Fresh factors only contribute to composite score
