# Data Artifact Schemas

Authoritative data contracts for all system artifacts.

## latest.json

Main dashboard data artifact generated by ETL pipeline.

```json
{
  "version": "v3.1.0",
  "updated_at": "2025-09-17T12:00:00.000Z",
  "price_usd": 67500.00,
  "composite_raw": 50,
  "composite_score": 50,
  "band": {
    "name": "Hold/Neutral",
    "lo": 35,
    "hi": 55,
    "color": "#f59e0b",
    "recommendation": "Wait and watch market conditions"
  },
  "pillars": [
    {
      "key": "liquidity",
      "weight": 40,
      "score": 45,
      "status": "fresh"
    }
  ],
  "factors": [
    {
      "key": "etf_flows",
      "label": "ETF Flows",
      "pillar": "liquidity",
      "weight": 10,
      "score": 93,
      "status": "fresh",
      "reason": "success",
      "details": [
        {
          "label": "Latest Daily Flow",
          "value": "$292K",
          "tooltip": "Exact: $292.3K (2025-09-16)"
        }
      ],
      "individualEtfFlows": {
        "ibit": 209.2,
        "fbtc": 45.8,
        "bitb": -10.8
      }
    }
  ],
  "adjustments": {
    "cycle": { "adj_pts": 0, "reason": "disabled" },
    "spike": { "adj_pts": 0, "reason": "disabled" }
  },
  "cross": {
    "btc_per_oz": 0.032,
    "oz_per_btc": 31.25
  },
  "config_digest": "etl_v3.1.0"
}
```

## status.json

System health and data source status.

```json
{
  "updated_at": "2025-09-17T12:00:00.000Z",
  "sources": [
    {
      "name": "FRED API",
      "ok": true,
      "ms": 245,
      "url": "https://api.stlouisfed.org/fred/",
      "schema_hash": "abc123",
      "z_tripwire": false,
      "cache_used": false
    },
    {
      "name": "Farside Investors",
      "ok": true,
      "ms": 1200,
      "url": "https://farside.co.uk/bitcoin-etf-flow/",
      "schema_hash": "def456",
      "z_tripwire": false,
      "cache_used": true
    }
  ]
}
```

## history.csv

Historical risk scores and metadata.

```csv
date,score,band,price_usd,version
2025-09-17,50,Hold/Neutral,67500.00,v3.1.0
2025-09-16,48,Regular DCA Buying,67200.00,v3.1.0
2025-09-15,52,Hold/Neutral,66800.00,v3.1.0
```

## signals/etf_flows_21d.csv

ETF flows signal data with statistical analysis.

```csv
date,day_flow_usd,sum21_usd,z,pct,score
2025-09-17,292300,2388700,-1.34,0.07,93
2025-09-16,185600,2156400,-1.45,0.05,95
2025-09-15,320100,1970800,-1.28,0.08,92
```

## extras/gold_cross.json (Planned)

BTCâ‡„Gold cross-rates (not emitted until feature ships).

```json
{
  "updated_at": "2025-09-17T12:00:00.000Z",
  "btc_per_oz": 0.032,
  "oz_per_btc": 31.25,
  "btc_usd": 67500.00,
  "gold_usd": 2100.00,
  "ratio_1y_pct": 15.2,
  "ratio_1y_percentile": 0.78,
  "status": "planned"
}
```

## API Response Schemas

### GET /api/data/latest

```json
{
  "ok": true,
  "as_of_utc": "2025-09-17T12:00:00.000Z",
  "composite_score": 50,
  "composite_raw": 50,
  "band": {
    "key": "hold_neutral",
    "label": "Hold/Neutral",
    "range": [35, 55],
    "color": "#f59e0b",
    "recommendation": "Wait and watch market conditions"
  },
  "health": "green",
  "factors": [...],
  "btc": {
    "spot_usd": 67500.00,
    "as_of_utc": "2025-09-17T12:00:00.000Z",
    "source": "ETL pipeline"
  },
  "provenance": [...],
  "model_version": "v3.1.0",
  "config_digest": "etl_v3.1.0",
  "transform": {}
}
```

### POST /api/refresh

Same schema as GET /api/data/latest, but with fresh real-time computation.

## Versioning

- **Semantic Versioning**: Major.Minor.Patch (e.g., v3.1.0)
- **Contract Changes**: Any schema change requires version bump
- **Backward Compatibility**: Maintained for at least 2 major versions
- **Migration Notes**: Documented in CHANGELOG.md for breaking changes

## Validation Rules

- **Required Fields**: All top-level fields must be present
- **Type Validation**: Strict type checking for all numeric and string fields
- **Range Validation**: Scores must be 0-100, dates must be valid ISO strings
- **Consistency Checks**: Factor weights must sum to 100%, band ranges must be valid
- **Staleness Rules**: Fresh factors only contribute to composite score
